# Medusa API æŠ˜æ‰£æ¨™ç±¤ç³»çµ±

## ğŸ“‹ ç³»çµ±èªªæ˜

æ­¤ç³»çµ±ç¾åœ¨**åªé¡¯ç¤ºä¾†è‡ª Medusa ä¿ƒéŠ·æ¨¡çµ„çš„çœŸå¯¦æŠ˜æ‰£æ¨™ç±¤**ï¼Œç§»é™¤äº†æ‰€æœ‰å…¶ä»–ä¾†æºçš„æ¨™ç±¤ï¼ˆmetadataã€tagsã€æœ¬åœ°è¨ˆç®—ç­‰ï¼‰ã€‚

## ğŸ¯ æ¨™ç±¤ä¾†æº

**å”¯ä¸€ä¾†æºï¼šMedusa ä¿ƒéŠ·æ¨¡çµ„ API**
- é€é `getActivePromotionLabels()` å‡½æ•¸ç²å–
- åŸºæ–¼çœŸå¯¦çš„è³¼ç‰©è»Šæ¸¬è©¦
- åªé¡¯ç¤ºæœ‰æ•ˆçš„ä¿ƒéŠ·æ´»å‹•æŠ˜æ‰£

## ğŸ·ï¸ æ”¯æ´çš„æ¨™ç±¤é¡å‹

### 1. ç™¾åˆ†æ¯”æŠ˜æ‰£ (`auto-discount`)
- **ä¾†æº**: Medusa ä¿ƒéŠ·æ´»å‹• (percentage type)
- **é¡¯ç¤º**: `7æŠ˜`, `8æŠ˜`, `9æŠ˜` ç­‰
- **ç¯„ä¾‹**: 20% OFF â†’ é¡¯ç¤ºç‚º `8æŠ˜`

### 2. å›ºå®šé‡‘é¡æŠ˜æ‰£ (`manual-discount`)
- **ä¾†æº**: Medusa ä¿ƒéŠ·æ´»å‹• (fixed type)
- **é¡¯ç¤º**: `-NT$200`, `æŠ˜NT$100` ç­‰
- **ç¯„ä¾‹**: å›ºå®šæŠ˜æ‰£ NT$50 â†’ é¡¯ç¤ºç‚º `æŠ˜NT$50`

### 3. è¨‚å–®æŠ˜æ‰£ (`campaign` / `special-event`)
- **ä¾†æº**: ä¿ƒéŠ·ä»£ç¢¼åŒ…å« "order"
- **é¡¯ç¤º**: `æ»¿é¡è¨‚å–®8æŠ˜`, `æ»¿é¡æŠ˜NT$200` ç­‰
- **ç¯„ä¾‹**: è¨‚å–®æ»¿é¡äº« 20% OFF â†’ é¡¯ç¤ºç‚º `æ»¿é¡è¨‚å–®8æŠ˜`

## âš™ï¸ æŠ€è¡“å¯¦ç¾

### å·¥ä½œæµç¨‹
1. **å‰µå»ºæ¸¬è©¦è³¼ç‰©è»Š**: ä½¿ç”¨æŒ‡å®š region
2. **æ·»åŠ å•†å“**: å°‡ç›®æ¨™å•†å“æ·»åŠ åˆ°è³¼ç‰©è»Š
3. **æª¢æŸ¥ä¿ƒéŠ·**: åˆ†ææ‡‰ç”¨çš„ä¿ƒéŠ·æ´»å‹•
4. **ç”Ÿæˆæ¨™ç±¤**: æ ¹æ“šä¿ƒéŠ·é¡å‹ç”Ÿæˆå°æ‡‰æ¨™ç±¤
5. **æ¸…ç†è³¼ç‰©è»Š**: åˆªé™¤æ¸¬è©¦ç”¨è³¼ç‰©è»Š

### API ç«¯é»
```javascript
// å‰µå»ºè³¼ç‰©è»Š
POST /store/carts
{
  "region_id": "reg_01JW1S1F7GB4ZP322G2DMETETH"
}

// æ·»åŠ å•†å“
POST /store/carts/{cart_id}/line-items
{
  "variant_id": "variant_id",
  "quantity": 1
}
```

### æ¨™ç±¤è¨ˆç®—é‚è¼¯
```javascript
// ç™¾åˆ†æ¯”æŠ˜æ‰£è½‰æ›ç‚ºå°ç£æŠ˜æ‰£è¡¨ç¤ºæ³•
const taiwanDiscount = (100 - discountPercent) / 10
const discountText = `${taiwanDiscount}æŠ˜`

// å›ºå®šé‡‘é¡æŠ˜æ‰£
const discountText = `-NT$${discountAmount}`
```

## ğŸ¨ æ¨™ç±¤æ¨£å¼

æ‰€æœ‰æ¨™ç±¤ä½¿ç”¨çµ±ä¸€çš„é»‘åº•ç™½å­—æ¨£å¼ï¼š
```css
.promotion-label {
  padding: 0.25rem 0.5rem;
  font-size: 0.75rem;
  font-weight: 600;
  border-radius: 0.375rem;
  background-color: rgba(41, 37, 36, 0.9);
  color: white;
  border: 1px solid white;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}
```

## ğŸ” æ¸¬è©¦èˆ‡é™¤éŒ¯

### æ¸¬è©¦é é¢
- **å°ˆç”¨æ¸¬è©¦é **: `http://localhost:3000/test-labels`
- **å•†å“é é¢**: `http://localhost:3000/products`

### é–‹ç™¼æ¨¡å¼æ—¥èªŒ
```javascript
console.log(`ã€${product.title}ã€‘Medusa API ä¿ƒéŠ·æ¨™ç±¤:`, labels)
console.log(`ã€${product.title}ã€‘æ¨™ç±¤æ•¸é‡:`, labels.length)
```

### æ¸¬è©¦è…³æœ¬
```bash
# åŸ·è¡Œä¿ƒéŠ·æ´»å‹•è¨­å®š
node setup-promotion-test.js

# æª¢æŸ¥ Medusa å¾Œç«¯ç‹€æ…‹
curl http://localhost:9000/health
```

## ğŸš« ç§»é™¤çš„åŠŸèƒ½

ä»¥ä¸‹åŠŸèƒ½å·²è¢«ç§»é™¤ï¼Œä¸å†æ”¯æ´ï¼š

### âŒ Metadata æ¨™ç±¤
- ä¸å†å¾ç”¢å“ `metadata` è®€å–ä¿ƒéŠ·æ¨™ç±¤
- ä¸æ”¯æ´æ‰‹å‹•è¨­å®šçš„æŠ˜æ‰£æ–‡å­—

### âŒ Tags æ¨™ç±¤  
- ä¸å†å¾ç”¢å“ `tags` è®€å–æ¨™ç±¤
- ä¸æ”¯æ´ "new", "hot", "featured" ç­‰æ¨™ç±¤

### âŒ æœ¬åœ°è¨ˆç®—æŠ˜æ‰£
- ä¸å†æ¯”è¼ƒ `original_amount` vs `calculated_amount`
- ä¸æ”¯æ´ fallback æ¨™ç±¤è¨ˆç®—

### âŒ åº«å­˜ç‹€æ…‹æ¨™ç±¤
- ä¸å†é¡¯ç¤º "å”®å®Œ"ã€"é è¨‚" ç­‰ç‹€æ…‹æ¨™ç±¤

## ğŸ“‹ å»ºç«‹ä¿ƒéŠ·æ´»å‹•

### é€é Medusa Admin
1. é–‹å•Ÿ `http://localhost:9000/admin`
2. ç™»å…¥ç®¡ç†å“¡å¸³è™Ÿ
3. é€²å…¥ "Promotions" é é¢
4. é»æ“Š "Create Promotion"
5. è¨­å®šä¿ƒéŠ·è³‡è¨Šï¼š
   - **Code**: ä¿ƒéŠ·ä»£ç¢¼ (å¦‚: SUMMER20)
   - **Type**: Percentage æˆ– Fixed
   - **Value**: æŠ˜æ‰£æ•¸å€¼
   - **Application**: Products æˆ– Order
6. å„²å­˜ä¸¦å•Ÿç”¨

### ç¯„ä¾‹ä¿ƒéŠ·æ´»å‹•
```json
{
  "code": "SUMMER20",
  "type": "percentage",
  "value": 20,
  "application_method": {
    "type": "percentage",
    "target_type": "items"
  }
}
```

## ğŸ¯ å„ªé»

### âœ… æ•¸æ“šæº–ç¢ºæ€§
- åªé¡¯ç¤ºçœŸå¯¦æœ‰æ•ˆçš„ä¿ƒéŠ·æ´»å‹•
- é¿å…å‡è³‡æ–™æˆ–éæœŸæ¨™ç±¤

### âœ… ä¸€è‡´æ€§
- èˆ‡è³¼ç‰©è»Šè¨ˆç®—é‚è¼¯å®Œå…¨ä¸€è‡´
- ç”¨æˆ¶çœ‹åˆ°çš„æ¨™ç±¤èˆ‡å¯¦éš›æŠ˜æ‰£ç›¸ç¬¦

### âœ… ç¶­è­·ç°¡å–®
- å–®ä¸€è³‡æ–™ä¾†æºï¼Œæ˜“æ–¼ç®¡ç†
- æ¸›å°‘ç¨‹å¼ç¢¼è¤‡é›œåº¦

### âœ… å•†æ¥­é‚è¼¯æ¸…æ™°
- ä¿ƒéŠ·æ´»å‹•ç”±å¾Œç«¯çµ±ä¸€ç®¡ç†
- å‰ç«¯åªè² è²¬é¡¯ç¤ºï¼Œä¸åšè¨ˆç®—

---

**é€™å€‹ç°¡åŒ–çš„ç³»çµ±ç¢ºä¿äº†æ¨™ç±¤çš„æº–ç¢ºæ€§å’Œä¸€è‡´æ€§ï¼Œåªé¡¯ç¤ºä¾†è‡ª Medusa ä¿ƒéŠ·æ¨¡çµ„çš„çœŸå¯¦æŠ˜æ‰£æ¨™ç±¤ã€‚**
