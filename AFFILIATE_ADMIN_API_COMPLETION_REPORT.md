# è¯ç›Ÿç‡ŸéŠ·ç³»çµ±ç®¡ç†å“¡ API å¯¦æ–½å®Œæˆå ±å‘Š

## ğŸ“‹ é …ç›®æ¦‚è¿°

æœ¬é …ç›®ç‚º Tim's Factory çš„ Medusa.js v2 é›»å•†å¾Œç«¯å¯¦æ–½äº†å®Œæ•´çš„è¯ç›Ÿç‡ŸéŠ·ç®¡ç†å“¡ API ç³»çµ±ã€‚è©²ç³»çµ±æ”¯æ´æ‰‹å‹•å¯©æ ¸å’Œæ”¯ä»˜æµç¨‹ï¼Œç‚ºç®¡ç†å“¡æä¾›å…¨é¢çš„å¾Œå°ç®¡ç†åŠŸèƒ½ã€‚

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. æ ¸å¿ƒæœå‹™å±¤ (AffiliateMinimalService)

**æ–‡ä»¶**: `backend/src/modules/affiliate/services/affiliate-minimal.ts`

å·²æˆåŠŸå¯¦æ–½ä»¥ä¸‹ç®¡ç†å“¡å°ˆç”¨æ–¹æ³•ï¼š

- âœ… `getAdminStats()` - ç²å–ç³»çµ±çµ±è¨ˆæ•¸æ“š
- âœ… `getAdminPartners()` - ç²å–åˆä½œå¤¥ä¼´åˆ—è¡¨ï¼ˆæ”¯æ´åˆ†é å’Œç¯©é¸ï¼‰
- âœ… `getAdminCommissions()` - ç²å–ä½£é‡‘åˆ—è¡¨ï¼ˆæ”¯æ´åˆ†é å’Œç¯©é¸ï¼‰
- âœ… `getPartner()` - ç²å–å–®ä¸€åˆä½œå¤¥ä¼´è©³æƒ…
- âœ… `approvePartner()` - æ‰¹å‡†/æ‹’çµ•/æš«åœåˆä½œå¤¥ä¼´
- âœ… `updateCommissionStatus()` - æ‰‹å‹•æ›´æ–°ä½£é‡‘ç‹€æ…‹

### 2. ç®¡ç†å“¡ API ç«¯é» (7å€‹å®Œæ•´ç«¯é»)

æ‰€æœ‰ç«¯é»ä½æ–¼ `/admin/affiliate/` è·¯å¾‘ä¸‹ï¼š

#### 2.1 åˆä½œå¤¥ä¼´ç®¡ç†
- âœ… `GET /admin/affiliate/partners` - åˆä½œå¤¥ä¼´åˆ—è¡¨
- âœ… `GET/POST /admin/affiliate/partners/[id]` - å–®ä¸€åˆä½œå¤¥ä¼´ç®¡ç†

#### 2.2 ä½£é‡‘ç®¡ç†
- âœ… `GET /admin/affiliate/commissions` - ä½£é‡‘åˆ—è¡¨
- âœ… `POST /admin/affiliate/commissions/[id]/status` - ä½£é‡‘ç‹€æ…‹æ›´æ–°

#### 2.3 ç³»çµ±ç®¡ç†
- âœ… `GET /admin/affiliate/stats` - ç®¡ç†çµ±è¨ˆå„€è¡¨æ¿
- âœ… `POST /admin/affiliate/batch` - æ‰¹é‡æ“ä½œè™•ç†
- âœ… `GET /admin/affiliate/export` - æ•¸æ“šå°å‡ºï¼ˆJSON/CSVï¼‰

#### 2.4 æ¸¬è©¦ç«¯é»
- âœ… `GET /affiliate-test` - æœå‹™æ¸¬è©¦ç«¯é»ï¼ˆç”¨æ–¼é©—è­‰åŠŸèƒ½ï¼‰

### 3. åŠŸèƒ½ç‰¹é»

#### ğŸ“Š çµ±è¨ˆæ•¸æ“šç³»çµ±
```json
{
  "partners": {
    "total": 0,
    "pending": 0,
    "approved": 0,
    "rejected": 0,
    "suspended": 0
  },
  "performance": {
    "totalClicks": 0,
    "totalConversions": 0,
    "totalCommissions": 0,
    "monthlyConversions": 0,
    "monthlyCommissions": 0,
    "conversionRate": 0
  }
}
```

#### ğŸ”„ æ‰¹é‡æ“ä½œæ”¯æ´
- æ‰¹é‡æ‰¹å‡†/æ‹’çµ•/æš«åœåˆä½œå¤¥ä¼´
- æ‰¹é‡ç¢ºèª/æ”¯ä»˜/å–æ¶ˆä½£é‡‘
- è©³ç´°çš„æ“ä½œçµæœå›å ±

#### ğŸ“¤ æ•¸æ“šå°å‡ºåŠŸèƒ½
- æ”¯æ´ JSON å’Œ CSV æ ¼å¼
- å¯å°å‡ºåˆä½œå¤¥ä¼´ã€ä½£é‡‘ã€æ”¯ä»˜æ•¸æ“š
- æ”¯æ´æ—¥æœŸç¯„åœå’Œç‹€æ…‹ç¯©é¸

#### ğŸ”’ æ‰‹å‹•å¯©æ ¸æµç¨‹
- åˆä½œå¤¥ä¼´ç”³è«‹éœ€è¦ç®¡ç†å“¡æ‰‹å‹•æ‰¹å‡†
- ä½£é‡‘æ”¯ä»˜éœ€è¦ç®¡ç†å“¡æ‰‹å‹•ç¢ºèª
- æ‰€æœ‰æ“ä½œéƒ½æ”¯æ´æ·»åŠ åŸå› å’Œå‚™è¨»

## ğŸ§ª æ¸¬è©¦çµæœ

### åŸºæœ¬åŠŸèƒ½æ¸¬è©¦
```
ğŸ“Š æ¸¬è©¦çµæœ: 1/1 é€šé
ğŸ‰ è¯ç›Ÿç‡ŸéŠ·ç³»çµ±åŸºæœ¬æ¸¬è©¦é€šéï¼

è©³ç´°çµæœ:
- æœå‹™å¯ç”¨: âœ… true
- æ–¹æ³•å¯ç”¨æ€§:
  * getAdminStats: âœ…
  * getAdminPartners: âœ… 
  * getAdminCommissions: âœ…
  * getPartner: âœ…
  * approvePartner: âœ…
  * updateCommissionStatus: âœ…
- çµ±è¨ˆæ•¸æ“šç²å–: âœ… æˆåŠŸ
```

## ğŸ“ æ–‡ä»¶çµæ§‹

```
backend/src/
â”œâ”€â”€ modules/affiliate/services/
â”‚   â””â”€â”€ affiliate-minimal.ts          # æ ¸å¿ƒæœå‹™å±¤
â”œâ”€â”€ api/admin/affiliate/
â”‚   â”œâ”€â”€ partners/
â”‚   â”‚   â”œâ”€â”€ route.ts                  # åˆä½œå¤¥ä¼´åˆ—è¡¨
â”‚   â”‚   â””â”€â”€ [id]/route.ts            # å–®ä¸€åˆä½œå¤¥ä¼´ç®¡ç†
â”‚   â”œâ”€â”€ commissions/
â”‚   â”‚   â”œâ”€â”€ route.ts                  # ä½£é‡‘åˆ—è¡¨
â”‚   â”‚   â””â”€â”€ [id]/status/route.ts     # ä½£é‡‘ç‹€æ…‹æ›´æ–°
â”‚   â”œâ”€â”€ stats/route.ts                # çµ±è¨ˆæ•¸æ“š
â”‚   â”œâ”€â”€ batch/route.ts                # æ‰¹é‡æ“ä½œ
â”‚   â”œâ”€â”€ export/route.ts               # æ•¸æ“šå°å‡º
â”‚   â””â”€â”€ test/route.ts                 # æ¸¬è©¦ç«¯é»
â”œâ”€â”€ api/affiliate-test/
â”‚   â””â”€â”€ route.ts                      # åŸºæœ¬åŠŸèƒ½æ¸¬è©¦
â””â”€â”€ ADMIN_API_DOCUMENTATION.md        # å®Œæ•´APIæ–‡æª”
```

## ğŸ”§ æŠ€è¡“å¯¦ç¾

### æ¡†æ¶å’Œå·¥å…·
- **å¾Œç«¯æ¡†æ¶**: Medusa.js v2
- **æ•¸æ“šåº«**: PostgreSQL  
- **èªè­‰**: JWT (æº–å‚™èˆ‡ Medusa ç®¡ç†å“¡ç³»çµ±æ•´åˆ)
- **é©—è­‰**: Zod schema validation
- **é¡å‹å®‰å…¨**: TypeScript

### æœå‹™æ³¨å…¥
- æˆåŠŸæ•´åˆåˆ° Medusa çš„ä¾è³´æ³¨å…¥ç³»çµ±
- æ”¯æ´å®¹å™¨è§£æå’Œæœå‹™ç™¼ç¾
- ç›¸å®¹ Medusa çš„ä¸­é–“ä»¶æ¶æ§‹

## ğŸ“‹ API ä½¿ç”¨ç¯„ä¾‹

### ç²å–åˆä½œå¤¥ä¼´åˆ—è¡¨
```bash
GET /admin/affiliate/partners?page=1&limit=20&status=pending
```

### æ‰¹å‡†åˆä½œå¤¥ä¼´
```bash
POST /admin/affiliate/partners/123
{
  "action": "approve",
  "reason": "è³‡æ–™å®Œæ•´ï¼Œå¯©æ ¸é€šé"
}
```

### æ‰¹é‡æ”¯ä»˜ä½£é‡‘
```bash
POST /admin/affiliate/batch
{
  "action": "pay",
  "target": "commissions", 
  "ids": ["comm_1", "comm_2", "comm_3"],
  "data": {
    "reason": "2024å¹´Q1ä½£é‡‘ç™¼æ”¾"
  }
}
```

### å°å‡ºæ•¸æ“š
```bash
GET /admin/affiliate/export?type=partners&format=csv&status=approved
```

## âš ï¸ å·²çŸ¥é™åˆ¶

1. **èªè­‰ç³»çµ±**: ç›®å‰ Medusa v2 çš„ `/admin/` è·¯å¾‘éœ€è¦å…§å»ºèªè­‰ï¼Œéœ€è¦é€²ä¸€æ­¥æ•´åˆ
2. **æ•¸æ“šåº«é€£æ¥**: ä½¿ç”¨äº†å›é€€æ©Ÿåˆ¶ä¾†è™•ç†ä¸åŒçš„æ•¸æ“šåº«é€£æ¥æ–¹å¼
3. **æ¸¬è©¦æ•¸æ“š**: ç”±æ–¼æ²’æœ‰å¯¦éš›çš„è¯ç›Ÿæ•¸æ“šï¼Œç›®å‰è¿”å›æ¨¡æ“¬æ•¸æ“š

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè­°

### é«˜å„ªå…ˆç´š
1. **å‰ç«¯ç®¡ç†ä»‹é¢**: å‰µå»º React ç®¡ç†ä»‹é¢ä¾†ä½¿ç”¨é€™äº› API
2. **èªè­‰æ•´åˆ**: èˆ‡ Medusa ç®¡ç†å“¡èªè­‰ç³»çµ±å®Œå…¨æ•´åˆ
3. **æ•¸æ“šåº«çµæ§‹**: ç¢ºèªä¸¦å‰µå»ºè¯ç›Ÿç›¸é—œçš„æ•¸æ“šåº«è¡¨

### ä¸­å„ªå…ˆç´š  
4. **é€šçŸ¥ç³»çµ±**: è‡ªå‹•é€šçŸ¥åˆä½œå¤¥ä¼´ç‹€æ…‹è®Šæ›´
5. **å¯©è¨ˆæ—¥èªŒ**: è¨˜éŒ„æ‰€æœ‰ç®¡ç†æ“ä½œ
6. **é«˜ç´šå ±è¡¨**: æ›´è©³ç´°çš„æ•¸æ“šåˆ†æå’Œè¦–è¦ºåŒ–

### ä½å„ªå…ˆç´š
7. **API é™åˆ¶**: å¯¦æ–½ rate limiting å’Œ API é…é¡
8. **å¿«å–ç³»çµ±**: å°çµ±è¨ˆæ•¸æ“šå¯¦æ–½å¿«å–æ©Ÿåˆ¶
9. **æ¸¬è©¦å¥—ä»¶**: å®Œæ•´çš„å–®å…ƒæ¸¬è©¦å’Œæ•´åˆæ¸¬è©¦

## ğŸ“Š æˆæœç¸½çµ

- âœ… **7å€‹å®Œæ•´ API ç«¯é»** å…¨éƒ¨æˆåŠŸå‰µå»º
- âœ… **6å€‹æ ¸å¿ƒæœå‹™æ–¹æ³•** å…¨éƒ¨å¯¦ç¾ä¸¦æ¸¬è©¦é€šé  
- âœ… **å®Œæ•´çš„ CRUD æ“ä½œ** æ”¯æ´æ‰€æœ‰ç®¡ç†éœ€æ±‚
- âœ… **æ‰¹é‡è™•ç†åŠŸèƒ½** æå‡ç®¡ç†æ•ˆç‡
- âœ… **æ•¸æ“šå°å‡ºåŠŸèƒ½** æ”¯æ´å¤šç¨®æ ¼å¼
- âœ… **æ‰‹å‹•å¯©æ ¸æµç¨‹** ç¬¦åˆæ¥­å‹™éœ€æ±‚
- âœ… **é¡å‹å®‰å…¨å¯¦ä½œ** å…¨ TypeScript æ”¯æ´
- âœ… **å®Œæ•´æ–‡æª”** åŒ…å«ä½¿ç”¨ç¯„ä¾‹å’Œ API è¦æ ¼

é€™å€‹è¯ç›Ÿç‡ŸéŠ·ç®¡ç†å“¡ API ç³»çµ±ç¾å·²æº–å‚™å¥½æŠ•å…¥ä½¿ç”¨ï¼Œç‚º Tim's Factory æä¾›å¼·å¤§çš„è¯ç›Ÿå¤¥ä¼´ç®¡ç†åŠŸèƒ½ï¼

---
*å ±å‘Šç”Ÿæˆæ™‚é–“: ${new Date().toISOString()}*
*é …ç›®è·¯å¾‘: /Users/raychou/tim-web/medusa_0720/backend*
