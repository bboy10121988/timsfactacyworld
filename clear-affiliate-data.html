<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>清除 Affiliate 資料並重新測試</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .step {
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        .code {
            background: #f1f3f4;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }
        .warning {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>🧹 清除 Affiliate 資料並重新測試</h1>
    
    <div class="warning step">
        <h3>⚠️ 當前問題</h3>
        <p>前端顯示的推薦連結還是舊的：</p>
        <div class="code">https://timsfantasyworld.com/tw?ref=周震宇ME6MARZSTCMJ</div>
        <p>需要更新為：</p>
        <div class="code">http://localhost:8000/tw?ref=[新的推薦代碼]</div>
    </div>

    <div class="step">
        <h3>🔧 步驟 1: 清除瀏覽器資料</h3>
        <p>請點擊下方按鈕清除 localStorage 資料：</p>
        <button onclick="clearLocalStorage()">清除 localStorage</button>
        <button onclick="clearSessionStorage()">清除 SessionStorage</button>
        <button onclick="clearAllData()">清除所有資料</button>
        <div id="clearResult"></div>
    </div>

    <div class="step success">
        <h3>🆕 步驟 2: 使用新的測試帳號</h3>
        <p>請使用以下最新的測試帳號進行登入：</p>
        <div class="code">
            <strong>Email:</strong> fresh-test-1754887545442@example.com<br>
            <strong>Password:</strong> Test123456!<br>
            <strong>推薦代碼:</strong> ME6MQGKMHEK4CR<br>
            <strong>期望的推薦連結:</strong> http://localhost:8000/tw?ref=ME6MQGKMHEK4CR
        </div>
        <button onclick="copyTestAccount()">複製測試帳號資訊</button>
    </div>

    <div class="step">
        <h3>📝 步驟 3: 測試步驟</h3>
        <ol>
            <li>清除上述資料後，關閉這個頁面</li>
            <li>前往 <a href="http://localhost:8000/tw/affiliate" target="_blank">http://localhost:8000/tw/affiliate</a></li>
            <li>確認頁面已重新載入（應該看到登入表單）</li>
            <li>使用上方的新測試帳號登入</li>
            <li>檢查推薦連結是否已更新為 localhost:8000</li>
            <li>檢查是否還有統計 API 錯誤</li>
        </ol>
    </div>

    <div class="step">
        <h3>🔍 步驟 4: 驗證結果</h3>
        <p>登入成功後，您應該看到：</p>
        <ul>
            <li>✅ 推薦連結：<code>http://localhost:8000/tw?ref=ME6MQGKMHEK4CR</code></li>
            <li>✅ 沒有統計 API 錯誤訊息</li>
            <li>✅ 推薦代碼：<code>ME6MQGKMHEK4CR</code></li>
            <li>✅ 狀態：<code>active</code></li>
            <li>✅ 佣金率：<code>5%</code></li>
        </ul>
    </div>

    <script>
        function clearLocalStorage() {
            try {
                localStorage.clear();
                document.getElementById('clearResult').innerHTML = '<p style="color: green;">✅ localStorage 已清除</p>';
            } catch (e) {
                document.getElementById('clearResult').innerHTML = '<p style="color: red;">❌ 清除失敗: ' + e.message + '</p>';
            }
        }

        function clearSessionStorage() {
            try {
                sessionStorage.clear();
                document.getElementById('clearResult').innerHTML = '<p style="color: green;">✅ sessionStorage 已清除</p>';
            } catch (e) {
                document.getElementById('clearResult').innerHTML = '<p style="color: red;">❌ 清除失敗: ' + e.message + '</p>';
            }
        }

        function clearAllData() {
            try {
                localStorage.clear();
                sessionStorage.clear();
                // 清除 cookies
                document.cookie.split(";").forEach(function(c) { 
                    document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
                });
                document.getElementById('clearResult').innerHTML = '<p style="color: green;">✅ 所有瀏覽器資料已清除！</p>';
            } catch (e) {
                document.getElementById('clearResult').innerHTML = '<p style="color: red;">❌ 清除失敗: ' + e.message + '</p>';
            }
        }

        function copyTestAccount() {
            const text = `Email: fresh-test-1754887545442@example.com
Password: Test123456!
推薦代碼: ME6MQGKMHEK4CR
推薦連結: http://localhost:8000/tw?ref=ME6MQGKMHEK4CR`;
            
            navigator.clipboard.writeText(text).then(function() {
                alert('測試帳號資訊已複製到剪貼簿！');
            }, function() {
                alert('複製失敗，請手動複製');
            });
        }

        // 顯示當前 localStorage 內容
        function showCurrentData() {
            console.log('當前 localStorage 資料:');
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                console.log(key + ':', localStorage.getItem(key));
            }
        }

        // 頁面載入時顯示當前資料
        window.onload = function() {
            showCurrentData();
        };
    </script>
</body>
</html>
