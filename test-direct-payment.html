<!DOCTYPE html>
<html>
<head>
    <title>直接測試 ECPay</title>
    <meta charset="UTF-8">
</head>
<body>
    <h2>直接測試 ECPay 付款</h2>
    <button onclick="testPayment()">測試付款</button>
    <div id="result"></div>

    <script>
        async function testPayment() {
            console.log('開始測試付款...')
            
            try {
                // 直接調用後端 API
                const response = await fetch('http://localhost:9000/store/ecpay/create-payment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-publishable-api-key': 'pk_01JZ9GCZ3EYS15P07M93RXCMMZ'
                    },
                    body: JSON.stringify({
                        cart_id: 'test_cart_123',
                        customer_id: 'test_customer_123',
                        shipping_address: {
                            first_name: 'Ray',
                            last_name: 'Chou',
                            phone: '0983344735',
                            city: '新北市',
                            address_1: '大里區益民路二段274巷25號1樓'
                        },
                        shipping_method: 'home_delivery'
                    })
                })
                
                const data = await response.json()
                console.log('後端回應:', data)
                
                if (data.html) {
                    // 直接將 HTML 寫入頁面並提交
                    document.getElementById('result').innerHTML = data.html
                    
                    // 查找表單並提交
                    const form = document.querySelector('form')
                    if (form) {
                        console.log('找到表單，準備提交...')
                        form.submit()
                    } else {
                        console.error('沒有找到表單')
                    }
                } else {
                    console.error('沒有收到 HTML')
                    document.getElementById('result').innerHTML = '<p>錯誤: ' + JSON.stringify(data) + '</p>'
                }
                
            } catch (error) {
                console.error('測試失敗:', error)
                document.getElementById('result').innerHTML = '<p>錯誤: ' + error.message + '</p>'
            }
        }
    </script>
</body>
</html>
