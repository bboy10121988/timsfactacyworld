<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤¥ä¼´ç®¡ç†æ¸¬è©¦é é¢</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center">å¤¥ä¼´ç®¡ç†ç³»çµ±æ¸¬è©¦</h1>
        
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ” ç®¡ç†å“¡èªè­‰æ¸¬è©¦</h2>
            <div class="space-y-4">
                <div class="flex gap-4">
                    <input type="email" id="adminEmail" placeholder="ç®¡ç†å“¡éƒµç®±" 
                           value="admin@timsfactory.com" class="border rounded px-3 py-2 flex-1">
                    <input type="password" id="adminPassword" placeholder="å¯†ç¢¼" 
                           value="admin123" class="border rounded px-3 py-2 flex-1">
                    <button onclick="testAdminLogin()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                        æ¸¬è©¦ç™»å…¥
                    </button>
                </div>
                <div id="loginResult" class="text-sm"></div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ‘¥ å¤¥ä¼´åˆ—è¡¨æ¸¬è©¦</h2>
            <div class="space-y-4">
                <button onclick="testPartnersList()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    è¼‰å…¥å¤¥ä¼´åˆ—è¡¨
                </button>
                <div id="partnersResult" class="text-sm"></div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ“Š çµ±è¨ˆæ•¸æ“šæ¸¬è©¦</h2>
            <div class="space-y-4">
                <button onclick="testStats()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                    è¼‰å…¥çµ±è¨ˆæ•¸æ“š
                </button>
                <div id="statsResult" class="text-sm"></div>
            </div>
        </div>
    </div>

    <script>
        const BACKEND_URL = 'http://localhost:9000';
        let adminToken = null;

        async function makeRequest(endpoint, options = {}) {
            const url = `${BACKEND_URL}${endpoint}`;
            
            const defaultHeaders = {
                'Content-Type': 'application/json',
                ...(adminToken && { 'Authorization': `Bearer ${adminToken}` })
            };

            try {
                const response = await fetch(url, {
                    ...options,
                    headers: {
                        ...defaultHeaders,
                        ...options.headers
                    }
                });

                const data = await response.json();
                return { status: response.status, data, success: response.ok };
            } catch (error) {
                return { status: 0, error: error.message, success: false };
            }
        }

        async function testAdminLogin() {
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            const resultDiv = document.getElementById('loginResult');
            
            resultDiv.innerHTML = 'â³ æ¸¬è©¦ä¸­...';
            
            const result = await makeRequest('/admin-auth', {
                method: 'POST',
                body: JSON.stringify({ email, password })
            });
            
            if (result.success && result.data.success) {
                adminToken = result.data.data.token;
                resultDiv.innerHTML = `âœ… ç™»å…¥æˆåŠŸï¼Token é•·åº¦: ${adminToken.length}`;
                resultDiv.className = 'text-sm text-green-600 bg-green-50 p-3 rounded';
            } else {
                resultDiv.innerHTML = `âŒ ç™»å…¥å¤±æ•—: ${result.data?.error || result.error || 'æœªçŸ¥éŒ¯èª¤'}`;
                resultDiv.className = 'text-sm text-red-600 bg-red-50 p-3 rounded';
            }
        }

        async function testPartnersList() {
            const resultDiv = document.getElementById('partnersResult');
            
            resultDiv.innerHTML = 'â³ è¼‰å…¥ä¸­...';
            
            const result = await makeRequest('/affiliate-admin/partners');
            
            if (result.success && result.data.success) {
                const partners = result.data.data.partners || [];
                resultDiv.innerHTML = `
                    âœ… æˆåŠŸè¼‰å…¥ ${partners.length} ä½å¤¥ä¼´
                    <br><strong>ç¸½è¨ˆ:</strong> ${result.data.data.total}
                    <br><strong>å·²æ‰¹å‡†:</strong> ${partners.filter(p => p.status === 'approved').length}
                    <br><strong>å¾…å¯©æ ¸:</strong> ${partners.filter(p => p.status === 'pending').length}
                    ${partners.length > 0 ? `<br><strong>ç¯„ä¾‹:</strong> ${partners[0].name} (${partners[0].email}) - ${partners[0].status}` : ''}
                `;
                resultDiv.className = 'text-sm text-green-600 bg-green-50 p-3 rounded';
            } else {
                resultDiv.innerHTML = `âŒ è¼‰å…¥å¤±æ•—: ${result.data?.error || result.error || 'æœªçŸ¥éŒ¯èª¤'}`;
                resultDiv.className = 'text-sm text-red-600 bg-red-50 p-3 rounded';
            }
        }

        async function testStats() {
            const resultDiv = document.getElementById('statsResult');
            
            if (!adminToken) {
                resultDiv.innerHTML = 'âŒ è«‹å…ˆç™»å…¥ç®¡ç†å“¡å¸³è™Ÿ';
                resultDiv.className = 'text-sm text-red-600 bg-red-50 p-3 rounded';
                return;
            }
            
            resultDiv.innerHTML = 'â³ è¼‰å…¥ä¸­...';
            
            const result = await makeRequest('/admin/affiliate/stats');
            
            if (result.success && result.data.success) {
                const stats = result.data.data;
                resultDiv.innerHTML = `
                    âœ… çµ±è¨ˆæ•¸æ“šè¼‰å…¥æˆåŠŸ
                    <br><strong>å¤¥ä¼´ç¸½æ•¸:</strong> ${stats.partners?.total || 0}
                    <br><strong>è½‰æ›æ¬¡æ•¸:</strong> ${stats.performance?.totalConversions || 0}
                    <br><strong>ç¸½ä½£é‡‘:</strong> ${stats.performance?.totalCommissions || 0}
                `;
                resultDiv.className = 'text-sm text-green-600 bg-green-50 p-3 rounded';
            } else {
                resultDiv.innerHTML = `âŒ è¼‰å…¥å¤±æ•—: ${result.data?.error || result.error || 'æœªçŸ¥éŒ¯èª¤'}`;
                resultDiv.className = 'text-sm text-red-600 bg-red-50 p-3 rounded';
            }
        }
    </script>
</body>
</html>
