# 行銷標籤完整清單

本文件彙整了整個系統中所有的「行銷標籤」類型與來源。

## 📋 標籤類型總覽

系統共定義了 **18 種** 行銷標籤類型：

### 1. 折扣相關標籤 (Discount Labels)
| 標籤類型 | 英文名稱 | 中文顯示 | 優先級 | 來源 |
|---------|---------|---------|-------|------|
| `auto-discount` | 自動計算折扣 | `X折` | 3 | Medusa API / 價格計算 |
| `manual-discount` | 手動設置折扣 | `自定義` | 4 | Metadata |
| `clearance` | 清倉特價 | `清倉特價` | 5 | Metadata |

### 2. 活動促銷標籤 (Campaign Labels)
| 標籤類型 | 英文名稱 | 中文顯示 | 優先級 | 來源 |
|---------|---------|---------|-------|------|
| `campaign` | 促銷活動 | `自定義活動名稱` | 6 | Metadata / Medusa API |
| `promotion` | 自定義促銷 | `自定義文字` | 10 | Metadata |
| `special-event` | 特殊活動 | `自定義活動名稱` | 11 | Metadata |
| `discount-code` | 折扣碼提示 | `輸入折扣碼享優惠` | 12 | Metadata |

### 3. 商品特性標籤 (Product Feature Labels)
| 標籤類型 | 英文名稱 | 中文顯示 | 優先級 | 來源 |
|---------|---------|---------|-------|------|
| `new` | 新品 | `NEW` | 14 | Metadata / Tags |
| `hot` | 熱銷 | `HOT` | 15 | Metadata / Tags |
| `bestseller` | 暢銷 | `BEST` | 16 | Metadata / Tags |
| `featured` | 精選 | `FEATURED` | 17 | Metadata / Tags / Collection |
| `sale` | 特價 | `SALE` | 18 | Metadata / Tags |

### 4. 限制性標籤 (Restriction Labels)
| 標籤類型 | 英文名稱 | 中文顯示 | 優先級 | 來源 |
|---------|---------|---------|-------|------|
| `limited` | 限量 | `LIMITED` | 9 | Metadata / Tags |
| `exclusive` | 獨家 | `獨家` | 8 | Metadata |
| `flash-sale` | 限時搶購 | `限時搶購` | 2 | Metadata |

### 5. 庫存狀態標籤 (Stock Status Labels)
| 標籤類型 | 英文名稱 | 中文顯示 | 優先級 | 來源 |
|---------|---------|---------|-------|------|
| `sold-out` | 售完 | `售完` | 1 | 庫存系統 |
| `preorder` | 預訂 | `預訂` | 13 | 庫存系統 |

### 6. 購買優惠標籤 (Purchase Benefit Labels)
| 標籤類型 | 英文名稱 | 中文顯示 | 優先級 | 來源 |
|---------|---------|---------|-------|------|
| `bundle` | 組合優惠 | `組合優惠` | 7 | Metadata / Medusa API |

## 🎯 標籤來源詳細說明

### 1. Medusa API 來源
透過 `getActivePromotionLabels()` 函數從 Medusa 後端取得真實促銷資料：
- **自動折扣**: 根據促銷活動自動計算百分比折扣
- **手動折扣**: 固定金額折扣
- **活動標籤**: 促銷活動名稱與代碼
- **組合優惠**: 買X送Y、滿件贈品等

### 2. 產品 Metadata 來源
在產品的 `metadata` 欄位中設定：
```json
{
  "discount": "20% OFF",
  "promotion": "夏日特惠",
  "promotion_type": "hot",
  "special_event": "週年慶",
  "campaign": "新品上市",
  "bundle": "買2送1",
  "flash_sale": "true",
  "clearance": "true",
  "exclusive": "true",
  "discount_code_available": "true"
}
```

### 3. 產品標籤 (Tags) 來源
在產品的 `tags` 中設定：
- `new` / `新品`
- `hot` / `熱銷`
- `limited` / `限量`
- `bestseller` / `暢銷`
- `featured` / `精選`

### 4. 價格計算來源
透過 `calculateProductDiscount()` 函數：
- 比較 `original_amount` 與 `calculated_amount`
- 自動計算折扣百分比
- 轉換為台灣習慣的「X折」表示法

### 5. 庫存系統來源
透過 `getProductStockStatus()` 函數：
- **售完狀態**: 所有變體都無庫存
- **預訂狀態**: 允許預訂但目前無庫存

### 6. 商品集合 (Collection) 來源
檢查產品所屬的集合：
- 集合 handle 為 `featured` 或 `精選` → 顯示精選標籤

## 🔄 標籤獲取流程

1. **優先使用 Medusa API**: `getActivePromotionLabels()`
2. **失敗時回退本地計算**: `getPromotionLabels()`
3. **按優先級排序顯示**: 數字越小優先級越高
4. **最多顯示 3 個標籤**: 避免介面過於擁擠

## 🎨 標籤樣式

所有標籤都有對應的 CSS 樣式類別：
- **基礎樣式**: `.product-label`
- **特定樣式**: `.product-label.{type}`
- **動畫效果**: 部分標籤具有脈動、閃爍效果

## 📱 前端顯示邏輯

在 `ProductPreview` 組件中：
- **左上角顯示**: 非售完與預訂標籤
- **右下角顯示**: 售完/預訂狀態標籤
- **過濾邏輯**: 已售完商品不顯示其他促銷標籤

## 🔧 除錯與測試

### 開發模式輸出
```javascript
console.log(`【${product.title}】真實促銷標籤:`, labels)
console.log(`【${product.title}】回退促銷標籤:`, labels)
console.log(`【${product.title}】最終促銷標籤:`, labels)
```

### 測試腳本
- `/test-real-promotion-labels.js`: 測試真實促銷標籤取得
- `/backend/scripts/create-test-promotions.js`: 建立測試促銷活動

## 📚 相關檔案

- `/frontend/src/lib/promotion-utils.ts`: 主要邏輯檔案
- `/frontend/src/modules/products/components/product-preview/index.tsx`: 前端顯示組件
- `/frontend/src/styles/globals.css`: 標籤樣式定義
- `/frontend/src/lib/data/promotions.ts`: 促銷資料獲取
- `/frontend/src/lib/fake-promotion-data.ts`: 假資料與測試資料

---

**總結**: 系統提供了 18 種豐富的行銷標籤類型，涵蓋折扣、活動、商品特性、限制性、庫存狀態、購買優惠等各個面向，並支援多種資料來源與自動計算邏輯，能夠全面滿足電商平台的行銷需求。
